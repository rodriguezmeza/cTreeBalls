<HTML>
<BODY>
<PRE>
<!-- Manpage converted by man2html 3.0.1 -->
<B><A HREF="cballs.html">cballs(1)</A></B>                   LSST/CosmoININ PROJECT                   <B><A HREF="cballs.html">cballs(1)</A></B>




</PRE>
<H2>NAME</H2><PRE>
       cballs - (2,3)-Point Correlation Function computation code


</PRE>
<H2>SYNOPSIS</H2><PRE>
       <B>cballs</B> [ <I>parameter</I><B>_</B><I>file</I><B>_</B><I>name</I> ] [ <I>options</I> ]




</PRE>
<H2>DESCRIPTION</H2><PRE>
       <B>cballs</B> - computes the 2 or/and 3 point correlation functions using
       tree/balls methods, complexity O(N Log N).



</PRE>
<H2>OPTIONS</H2><PRE>
       All the options have the structure

       $ <I>option</I><B>_</B><I>name</I>=&lt;option_value&gt;

       except option <B>-help</B>. No space between <I>option</I><B>_</B><I>name</I>, '=' and
       &lt;option_value&gt;


       Options and their possible values are:


       <B>-help</B>       By writting


                   $ cballs --help


                   you will get the list of all parameters and their default
                   values. An option may have an alias which is a short name
                   of the option. If an option has an alias in the list above
                   it comes after its description surrounded by brackets
                   tagged with 'a:'. For example,


                   option_name=&lt;option_value&gt;    ... Description ... [a: opt]

                   here 'opt' is the short name of the option. In the
                   description of the options below, when an option has an
                   alias it will be noted in the same way but before its
                   description.


       <B>paramfile</B>   is the name file with the values of the input parameters.
                   Overwrite parameters values below. You may input this
                   filename by only writing:

                   $ cballs paramfile=parameters_input_file_name

                   Parameter input file may be created by hand with the editor
                   of your choice. Comment lines start with an "#" or "%".
                   Follow each name option with a blank-space, "=", blank-
                   space and the option value (note the difference when using
                   command line version instead of parameter file version).
                   The order of the option lines does not matter.  Also you
                   may create an example input file by executing

                   $ cballs

                   This will run the <B>cballs</B> code with default values and when
                   it finish you will have in your running output directory
                   (by default is 'Output', see below in 'rootDir' line) the
                   file "parameters_null-cballs-usedvalues". Now you may edit
                   this file to adapt to your own run parameters. This file
                   can be overwritten so it may be helpful to change this file
                   name to whatever apropriate, and move it elsewhere.


                   Note that parameter alias are not allowed in a parameter
                   file. Also behaviour of Mac and Linux plataforms are
                   different when they reach the end of line in a text file.
                   Then would be necessary to add a blank line at the end of
                   the parameter file.


       <B>searchMethod</B>
                   [a: search] is the searching method to use. Default is
                   'balls-omp'. Other search options will be added in the
                   addons folder, like 'octree-ggg-omp' searching method.


       <B>mChebyshev</B>  [a: mcheb] is the total number of chebyshev multipoles to
                   use. (mChebyshev + 1) must be a power of 2. Default value
                   is 7, which means that will be computed 8 multipoles.


       <B>nsmooth</B>     [a: nsm] number of bodies to smooth out (or in a bucket if
                   you are using 'searchMethod=kdtree-omp'). Default is 1, but
                   if you are using 'kdtree-omp' it is convenient to use
                   'nsmooth=8'.


       <B>rsmooth</B>     [a: rsm] radius of the pivot smoothing neighbourhood. If
                   empty a default is set.


       <B>theta</B>       control tree search parameter, can be used to
                   increase/decrease computation speed. It has the effect of
                   increasing ('theta&lt;1') or decreasing ('theta&gt;1') the radius
                   of cells. Default value is 1. Experiment with 'theta=1.1'
                   to see the speeding-up of the code. If 'theta=0' is used
                   then computation will be done as it were the direct-2-loops
                   method with complexity O(N^2), useful for testing but not
                   for productions computations.


       <B>computeTPCF</B> [a: tpcf] if true, compute 3pcf. If using 'octree-ggg-omp'
                   searching method, this option is activated at compile time
                   using flags defined in 'addons/Makefile_addons_settings'.


       <B>usePeriodic</B> [a: periodic] if false, do not use periodic boundary
                   condition. Useful to compute 2-point correlations functions
                   of periodic boxes steaming from N-body simulations or to
                   analyze halo catalogs from Rockstar for example. In such a
                   case use in combinations with 'computeTPCF=false'. <B>cballs</B>
                   is able to read Gadget format or multi-columns format files
                   like the ones given by Rockstar. See below.


       <B>infile</B>      [a: in]  gives the name of file to input the data to
                   analyse.


       <B>infileformat</B>
                   [a: infmt]  gives format of file to input the data to
                   analyse. Common options are: 'columns-ascii', 'binary',
                   'takahasi'. First one is a file with a header and all the
                   data point info is in column form: positions and
                   convergence field. The binary format is a <B>cballs</B> binary
                   format. Whereas takahasi format is for reading Takahasi
                   simulations data. Other file formats are in the addons.
                   Gadget format is one of them. Other is 'multi-columns-
                   ascii' which can be used in combinations with 'columns'
                   option in order to read files that are Rockstar output.
                   Also, <B>cballs</B> can read fits and healpix files. Note: you
                   need to set properly the format of the point catalog that
                   you are pretending to analyze, because if you mistakenly
                   set wrong format or positions or fields columns, you will
                   obtain wrong results or get a 'segmentation fault' error
                   and the code will stop. Please follow the examples given in
                   the tests folder.


       <B>iCatalog</B>    [a: icats] gives the indexes of point catalogs to analyse.
                   Useful to read several point catalogs to do cross-
                   correlations or to mix several files in one file or to
                   analyse several input file as they were only one.


                   Note here that the number of items in <B>infile</B>, <B>infileformat</B>
                   and <B>iCatalog</B> have to be the same.


       <B>rootDir</B>     [a: root] gives output dir, where output files will be
                   written. If this folder does not exist it will be created.
                   If it does exist it will be overwritten.


       <B>outfile</B>     [a: o] will give the name of file to save the data to be
                   analysed. The output is written in column form and a header
                   by default, there is also a binary format. And by default
                   this options is empty then no output file is saved. You can
                   use in combinations with 'options=stop' to just convert
                   input file format that can be use by other applications. It
                   can be use in combination with <B>infile</B>, <B>infileformat</B> and
                   <B>iCatalog</B> to read several files and save them as they were
                   only one.


                   Note: to this file name, an extension ".txt" is added.


       <B>oufileformat</B>
                   [a: ofmt]  gives format of file to output the data to be
                   analysed. Common options are: columns-ascii and binary.
                   They follow the <B>infileformat</B> above.


                   Note here that it is recommended to use binary format given
                   that save hard disk space and it is fastest to read.


       <B>thetaL</B>      angle theta left side of the region in radians. To see how
                   many arcmin it is, the factor of conversion is:
                   RADTOARCMIN=3437.74677.


       <B>thetaR</B>      angle theta right side of the region in radians.


       <B>phiL</B>        angle phi left side of the region in radians.


       <B>phiR</B>        angle phi right side of the region in radians.


                   Note: phi and theta angles correspond to RA and DEC in the
                   galactic coordinate system. And to convert them to a vector
                   position just use the standard spherical transformation of
                   coordinates.


                   Also note that these four parameters can be used as a
                   filter or mask to access only a patch of the full sky
                   region.


       <B>useLogHist</B>  [a: loghist] if true, it will use log scale in the r-bins
                   of histograms.


       <B>logHistBinsPD</B>
                   [a: binspd] Bins per decades in r-bins when
                   'useLogHist=true'.


       <B>sizeHistN</B>   gives the number of bins to create.


       <B>rangeN</B>      is the maximum separtion of bodies to search for sampling.
                   Default value is 0.0633205 that correspond to 217.68
                   arcmin.


       <B>rminHist</B>    is the minimum separtion of bodies to search for sampling.
                   Default value is 0.00213811 that correspond to 7.35 arcmin.


       <B>sizeHistPhi</B> array size for angular histogram.


       <B>histNNFileName</B>
                   [a: histNNfname] file name (without extension) to save
                   histograms of NN.


       <B>histXi2pcfFileName</B>
                   [a: histXi2pcffname] file name (without extension) to save
                   histograms of Xi2pcf.


       <B>histZetaFileName</B>
                   [a: histZfname] prefix of file name to save histograms of
                   matrix Zeta, for the multipoles.


       <B>suffixOutFiles</B>
                   [a: suffix] suffix to add to output filenames.


                   Note: to all above file names, an extension ".txt" is
                   added.



       <B>seed</B>        gives the seed to init the random number generator. Useful
                   random number seed to test run or useful to change a random
                   region in Takahashi simulations.


       <B>testmodel</B>   [a: tstmodel] is the name of the model of data to create.
                   By default this option is 'unit-sphere-random' which
                   creates a uniformly random distribution of point over a
                   unit spherical surface.


       <B>nbody</B>       is the total number of bodies to make as a test case. By
                   default a <B>nbody</B> random distribution of points are created
                   in a unit sphere. The random generator is initialize with a
                   seed given by <B>seed</B> option.


       <B>lengthBox</B>   [a: lbox] is the length of the box side. The box is where
                   the bodies reside. When a test simple-cubic or random-cubic
                   models are used then the lenghts of the box are fixed with
                   this parameter. When used with unit-sphere-random then box
                   has lenght of 2.


       <B>preScript</B>   scripts in shell or python that can be run in pre-
                   processing. Use in combinations with 'options=pre-
                   processing'. Last setting is necessary to activate the
                   script.


       <B>posScript</B>   scripts in shell or python that can be run in post-
                   processing. Use in combinations with 'options=post-
                   processing'. Last setting is necessary to activate the
                   script.


       <B>stepState</B>   gives the frequency to save the the number of pivot
                   computed. Useful to see the state of the run.


       <B>verbose</B>     [a: verb] to print messages to standard output (stdout).
                   There are four levels of information. When is "0", no
                   information is written.


       <B>verbose_log</B> [a: verblog] to save messages to a log file (in directory
                   "tmp"). When is "0" no information is written.


       <B>numberThreads</B>
                   [a: nthreads] To set the number of threads to use (OpenMP).


       <B>scanLevel</B>   [a: scl] scan level to start the search (look at tdepth
                   value, will be the maximum for this parameter).


       <B>scanLevelRoot</B>
                   [a: sclroot] scan level of root cells to start the search
                   (look at tdepth value, will be the maximum for this
                   parameter).


       <B>scanLevelMin</B>
                   [a: sclmin] scan level of size cells to stop the search.
                   Integer negative values (look at tdepth value, will be
                   tdepth-1+scanLevelMin+1).


       <B>ntosave</B>     [a: ntsav] number of found bodies to save; use in
                   combination with 'bodyfound', 'balls4' method.


       <B>columns</B>     [a: cols] columns to use as vector position and fields when
                   using multi-columns-ascii or fits formats of point catalog.


       <B>options</B>     [a: opt] you may give here various code behavior options,
                   like 'smooth-pivot', 'stop', 'pre-processing', 'post-
                   processing', etcetera.



</PRE>
<H2>EXAMPLES</H2><PRE>
       Note: It is assumed that working directory is cTreeBalls, as was
       created when was git cloned. First create the executable, 'cballs':


       $ make clean; make all


       cd tests


       $ time ../cballs nbody=100000 rangeN=0.06 sizeHistN=20 verb=2


       You will have computations written in files in a directory named with
       option <B>rootDir</B>. Not given here then it is used default 'Output'. If
       this directory does not exist, it will be created.  Also will be
       created a directory named "tmp" in this output folder, where a log file
       will be saved.


       Reading a Takahashi et al. (https://arxiv.org/abs/1706.01472)
       simulation data file downsized to 256:


       $ time ../cballs
       infile=./catalogs/Takahasi/allskymap_nres08r081_zs9_mag.fits
       infmt=fits-healpix options=stop


       To convert a catalog from healpix to ascii do:


       $ ../cballs in=./catalogs/Takahasi/allskymap_nres08r081_zs9_mag.fits
       infmt=fits-healpix o=takas options=stop


       Note here that <B>in</B> is the alias of <B>infile</B> and <B>infmt</B> is the alias of
       <B>infileformat</B>.


       In Output directory there will be a file named 'takas.txt', in this
       case, it is an ASCII file with a two lines header and then the several
       lines of columns with position '(x,y,z)' and convergence values. You
       can see its contents:


       $ more Output/takas.txt



       To compute correlations, <B>cballs</B> needs a catalog of bodies which
       contains at least their positions and values of the field whose
       correlations we are looking for. With all these values <B>cballs</B> builds up
       a structure of body info which consist in the general case of: Pos,
       Kappa, Weight, Mask, Id, Update, among other body information is needed
       to do the search and compute correlations we are interested in. The
       searching phase is done quite efficently by building a tree structure
       of the catalog data.


       We finish with the following examples:


       $ time ../cballs search=octree-ggg-omp
       infile=./catalogs/Takahasi/allskymap_nres08r081_zs9_mag.fits
       infmt=fits-healpix


       Plot the results with:


       $ python Xi3pcf_plot_flatten.py


       Now do


       $ time ../cballs search=octree-ggg-omp
       infile=./allskymap_nres10r081_zs9_mag.fits infmt=fits-healpix
       options=pre-processing,post-processing,no-normalize-HistZeta,edge-
       corrections,smooth-pivot preScript="ud_grade &lt; in_ud_grade"
       posScript="python Xi3pcf_plot_flatten_EE.py; rm -f
       allskymap_nres10r081_zs9_mag.fits"


       and the results were already plotted with the post-processing action in
       'options'. Also the file 'allskymap_nres10r081_zs9_mag.fits' was
       [removed!


       What does 'no-normalize-HistZeta,edge-corrections,smooth-pivot' mean?
       'smooth-pivot' speeds up computation. 'edge-corrections' makes 3-point
       correlation function corrections if we are using a patch of the sky, in
       this case catalog given is full-sky, not needed but 'edge-correction'
       works just fine. 'no-normalize-HistZeta' does not normalize 3-point
       correlation function histograms as it is needed by 'edge-corrections'
       option. Note also that these options only work when using 'octree-ggg-
       omp' searching method.


       Note: python version 3 was used with numpy and matplotlib modules
       installed. Also, for a long command line as above we may use '´ to
       split it shorter pieces.



</PRE>
<H2>SEE ALSO</H2><PRE>
       <B><A HREF="fkpt.html">fkpt(1)</A></B> <B><A HREF="mgpt.html">mgpt(1)</A></B> <B><A HREF="cballs.html">cballs(1)</A></B>



</PRE>
<H2>COPYRIGHT</H2><PRE>
       Copyright (C) 2023--2025
       Mario A. Rodriguez-Meza

UNIX                              April 2023                         <B><A HREF="cballs.html">cballs(1)</A></B>
</PRE>
<HR>
<ADDRESS>
Man(1) output converted with
<a href="http://www.oac.uci.edu/indiv/ehood/man2html.html">man2html</a>
</ADDRESS>
</BODY>
</HTML>
